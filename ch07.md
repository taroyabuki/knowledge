## 7 グラフネイティブ機械学習

```bash
cd
cd book-building-knowledge-graphs-ja/example/chapter7
```

### やり直す場合

シェルで次を実行して，全てを削除する．

```bash
cat << EOF | cypher-shell -u neo4j -p yolo
MATCH (n) DETACH DELETE n;

CALL gds.graph.drop('actors-graph');
CALL gds.beta.pipeline.drop('actors-pipeline');
CALL gds.beta.model.drop('actors-model');
CALL gds.graph.drop('actors-input-graph-for-prediction');
EOF
```

ブラウザで「`:play movie graph`」を実行，2/8のCypher「`CREATE (TheMatrix:Movie...`」を実行し，グラフを作成する．

（必要なら）リポジトリのリスト7-8を次のように修正する．

```
誤：pipeline: 'acrots',
正：pipeline: 'acrot-pipeline',
```

（必要なら）リポジトリのリスト7-13を次のように修正する（書籍は正しい）．

```
誤：WHERE elementId(a) > elementId(b)
正：WHERE id(a) > id(b)
```

ブラウザにコピペするのが面倒だから，シェルで実行する．

```bash
#リスト7-1から7-4
for file in 7-{1..4}.cypher; do
cypher-shell -u neo4j -p yolo < "$file"
done

#パイプラインの作成
echo "CALL gds.beta.pipeline.linkPrediction.create('actors-pipeline')" | cypher-shell -u neo4j -p yolo

#リスト7-5から7-7
for file in 7-{5..7}.cypher; do
cypher-shell -u neo4j -p yolo < "$file"
done

#モデルの指定
echo "CALL gds.beta.pipeline.linkPrediction.addLogisticRegression('actors-pipeline')" | cypher-shell -u neo4j -p yolo

#自動チューニング
echo "CALL gds.alpha.pipeline.linkPrediction.configureAutoTuning('actors-pipeline', {maxTrials: 100})" | cypher-shell -u neo4j -p yolo

#リスト7-8から7-14
for file in 7-{8..14}.cypher; do
echo "$file"
cypher-shell -u neo4j -p yolo < "$file"
done
```

